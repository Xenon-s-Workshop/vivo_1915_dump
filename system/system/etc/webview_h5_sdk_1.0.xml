'use strict';var e,t;e=this;
t=function(){function W(a){var b="";a=new RegExp(a+"=([^;]+);?s*");return document&&document.cookie&&(b=a.exec(document.cookie)),b?b[1]:""}function k(a,b){return Object.prototype.toString.call(a)==="[object "+b+"]"}function E(a,b){if(k(a,"Array"))for(var c=0;c<a.length;c++)a[c]&&a[c](b);else k(a,"Function")&&a(b)}function L(a){return/^(http|https):\/\//.test(a)?a:"https://"+a}function aa(a,b){P=a||P;A=b||A;!0}function F(a,b,c,d,g){var v=new XMLHttpRequest;a=L(a);if(1===b){var k=[];for(n in c)k.push(n+
"="+c[n]);var n=k.length?"?"+k.join("&"):"";a+=n}v.open(Q[b],a,!0);v.withCredentials=!1;v.send(c);v.onreadystatechange=ba.bind(v,d,g)}function ba(a,b){4===this.readyState&&E(200===this.status?a:b,this.responseText)}function M(a,b){a.set=[];a.kv={};a.setItem=function(c,d,g){b.setItem(c,d);a.kv[c]=d;-1===a.set.indexOf(c)&&a.set.push(c);g&&g(0)};a.getItem=function(c,d){d(b.getItem(c)||a.kv[c])};a.removeItem=function(c){b.removeItem(c);delete a.kv[c];c=a.set.indexOf(c);-1!==c&&a.set.splice(c,1)};a.clear=
function(){for(;a.set.length;)b.removeItem(a.set.pop());a.kv={}}}function ca(){if(w.match(/AppleWebKit.*Mobile.*/)){for(var a=[/Alipay/i,/MicroMessenger/i,/(UCBrowser)|(ucweb)/i,/WeiBo/i,/QQ\//i,/MQQBrowser/i,/baiduboxapp/i,/baidubrowser/i,/vivo/i,/\(i[^;]+;( U;)? CPU.+Mac OS X/,/(Android)|(Linux)/],b="alipay weixin ucbrowser weibo qq qqbrowser baidu baidubrowser vivo ios android".split(" "),c=-1;++c<a.length;)if(w.match(a[c]))return b[c];return"other"}return"pc"}function N(a){var b=w.toLowerCase(),
c="",d=a?/android [\d._]+/gi:/os [\d._]+/gi;0<b.indexOf(a?"android":"like mac os x")&&(c=(b.match(d)+"").replace(/[^0-9|_.]/gi,"").replace(/_/gi,"."));return c}var x={atob:function(a){if(0==(a=(a=String(a)).replace(/[ \t\n\f\r]/g,"")).length%4&&/==?$/.test(a)&&(a=a.replace(/==?$/,"")),1==a.length%4||!/^[+/0-9A-Za-z]*$/.test(a))return null;for(var b="",c=0,d=0,g=0;g<a.length;g++)c<<=6,c|=x.atobLookup(a[g]),24==(d+=6)&&(b+=String.fromCharCode((16711680&c)>>16),b+=String.fromCharCode((65280&c)>>8),b+=
String.fromCharCode(255&c),c=d=0);return 12==d?(c>>=4,b+=String.fromCharCode(c)):18==d&&(c>>=2,b+=String.fromCharCode((65280&c)>>8),b+=String.fromCharCode(255&c)),b},atobLookup:function(a){return/[A-Z]/.test(a)?a.charCodeAt(0)-65:/[a-z]/.test(a)?a.charCodeAt(0)-97+26:/[0-9]/.test(a)?a.charCodeAt(0)-48+52:"+"==a?62:"/"==a?63:void 0},btoa:function(a){var b;a=String(a);for(b=0;b<a.length;b++)if(255<a.charCodeAt(b))return null;var c="";for(b=0;b<a.length;b+=3){var d=[void 0,void 0,void 0,void 0];d[0]=
a.charCodeAt(b)>>2;d[1]=(3&a.charCodeAt(b))<<4;a.length>b+1&&(d[1]|=a.charCodeAt(b+1)>>4,d[2]=(15&a.charCodeAt(b+1))<<2);a.length>b+2&&(d[2]|=a.charCodeAt(b+2)>>6,d[3]=63&a.charCodeAt(b+2));for(var g=0;g<d.length;g++)void 0===d[g]?c+="=":c+=x.btoaLookup(d[g])}return c},btoaLookup:function(a){return 26>a?String.fromCharCode(a+65):52>a?String.fromCharCode(a-26+97):62>a?String.fromCharCode(a-52+48):62==a?"+":63==a?"/":void 0}},da=x.atob,ea=x.btoa,Q=["POST","GET"],P="cfg-stsdk.vivo.com.cn/",A=["native-single-h5sdk.vivo.com.cn",
"native-trace-h5sdk.vivo.com.cn","single-h5sdk.vivo.com.cn","trace-h5sdk.vivo.com.cn"],fa=["/client/upload/reportSingleImd","/client/upload/reportTraceImd","/h5/reportSingle","/h5/reportTrace"],ha=/(http(s)?:\/\/)?([^/]*)(\/.*)/,G="imei oaid vaid aaid gaid guid id_limited udid e cm model product elapsedtime session_id terminal sysversion app_package app_version_code app_version_name android_version st1 st2 sn1 sn2 ms userid os_type".split(" "),n=function(){},y=function(){return{setItem:n,getItem:n,
removeItem:n,clear:n}},ia={readyCB:n,errorCB:n,successCB:n},ja=window.navigator&&window.navigator.sendBeacon?function(a,b,c,d,g){window.navigator.sendBeacon(L(a),c)?E(d,"send beacon success"):F(a,b,c,d,g)}:F,H=y();y=y();var ka=window.screen.height,la=window.screen.width,B=window.navigator,w=B.userAgent,ma=window.self!==window.top;return sessionStorage&&M(H,sessionStorage),localStorage&&M(y,localStorage),function(a,b,c,d,g,v,w,y){function x(a,b,c){return function(f){"success"===b?R():2>a.retry++&&
I([a],!0,c);S--;(a[b+"Fn"]||J[b+"CB"])(f)}}function B(a,b,c){var f=[],q=[],d=[],l=[],u=void 0;!function C(z){if(!(z>=a.length)){var m=a[z],h="",p=m.data.event_id.split("|").pop();if(p="0"===p[0]?p.slice(1):p,D[p]&&(h=p),!h)return function(a,b){2>a.refresh++&&setTimeout(function(){I([a],!0,b)},300)}(m,b),C(++z);if(function(a,b){b=D[b].event.filter(function(b){return b.id===a.data.event_id});return!!b&&!!b[0]&&1===b[0].switch}(m,h))return C(++z);if(u&&h!==u)return I([m],!1,b),C(++z);u=h;g(function(h){S++;
m.data.nt=h;m.data.userid=T[u].userid;m.data.event_time=m.data.event_time||Date.now().toString();var p=u;h=m.data;if(h.params=h.params||{},k(h.params,"Object"))if(p=X[p])for(var g in p)h.params[g]=h.params[g]||p[g];(m.data=h,f.push(m.data),l.push(m.data.event_id),d.push(x(m,"error",b)),q.push(x(m,"success",b)),++z>=a.length)?(g={common:T[u]},g.common.cookie_id=Y,g[Q[b]]=f,c({d:g,i:l,s:q,e:d})):C(z)})}}(0)}function F(b,c){B(b,c,function(b){try{if(0===b.i.length)return;var f=JSON.stringify(b.d),h=U;
if(y&&top&&top.postMessage(JSON.stringify(f),"*"),2===h){var d=window.reportCommand.processEvent(f,c+1,!0,!0,""),l=da(d),q=new Uint8Array(new ArrayBuffer(l.length));f=0;for(var g=l.length;f<g;f++)q[f]=l.charCodeAt(f);var m=q}else m=ea(unescape(encodeURIComponent(f)));var p=["idList="+encodeURIComponent(b.i.join("-")),"sdkversion=1600","appId="+b.d.common.appId,"len="+m.length],n=(A[k=U+c-2]+"/").replace(ha,"$1$3")+fa[k]+"?"+p.join("&");a(n,0,m,b.s,b.e)}catch(na){r(na)}var k})}function R(){var a,b,
c=(a=K[0].length?0:1,b=K[a],K[a]=[],{t:b,p:a});c.t.length&&F(c.t,c.p)}function E(a,b){c.setItem("@_vtg_pene_pre_"+a.event_id,JSON.stringify(a.preparams||{}),function(){c.getItem("@_vtg_trace_ids",function(f){var d=f?f.split("-"):[],h=d.indexOf(a.event_id);-1!==h&&(d.splice(h),f=d.join("-"));5===d.length&&c.removeItem("@_vtg_pene_pre_"+d.shift());d.push(a.event_id);c.setItem("@_vtg_trace_ids",d.join("-"),function(){b({r:{},t:f})})})})}function L(a,b){E(a,function(a){var f=(a=a?a.t:"")?a.split("-"):
[],d={},g="",l=[],q=f.length;!function C(a){if(a)for(var h in g+="@",l.unshift(f[q]),a=JSON.parse(a))d[g+h]=a[h];0<=--q?c.getItem("@_vtg_pene_pre_"+f[q],C):b({r:d,t:l.join("-")})}(null)})}function M(a,b){d.getItem("@_vtg_unique_one",function(c){v(a,U,function(f){T[a.appId]=f;c||(c=Date.now()+"_"+function(a,b){var c,f,d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),h=[];if(b=b||d.length,a)for(c=0;c<a;c++)h[c]=d[0|Math.random()*b];else for(h[8]=h[13]=h[18]=h[23]="-",h[14]=
"4",c=0;36>c;c++)h[c]||(f=0|16*Math.random(),h[c]=d[19==c?3&f|8:f]);return h.join("")}(13,16),d.setItem("@_vtg_unique_one",c,function(){}));Y=c;b()})})}function N(a){V--;M(a,function(){R();Z=!0;J.readyCB()})}function I(a,b,c){try{for(var d=0;d<a.length;d++){var f=a[d]||{},g={data:b?f.data:k(l=f.data,"Object")?(l.start_time=l.start_time||Date.now().toString(),l.duration=l.duration||"0",l.report_type=l.report_type||0,l):r("data is not an Object"),successFn:f.successFn,errorFn:f.errorFn,retry:f.retry||
0,refresh:f.refresh||0};500>K[c].length?K[c].push(g):r("task stack reach stack threshold")}3>S&&Z&&!V&&R()}catch(u){r(u)}var l}function G(a){if(!a)return r("tasks not exist");k(a,"Array")||(a=[a]);(function O(b,c,d){if(b<a.length){var f=a[b];if(f.data&&f.data.event_id)switch(function(a){a=a.split("|");if(a[0]){if(5===a[0].length)return 0;if(3===a[0].length)return 1}return 2}(f.data.event_id)){case 0:c.push(f);O(++b,c,d);break;case 1:f.data.intercept_pierce=f.data.intercept_pierce||0;(0,[E,L][f.data.intercept_pierce])(f.data,
function(a){f.data.preparams=a.r;f.data.trace_id=a.t||"";d.push(f);O(++b,c,d)});break;default:O(++b,c,d)}else r("task data or event_id not exist"),O(++b,c,d)}else c.length&&I(c,!1,0),d.length&&I(d,!1,1)})(0,[],[])}function H(a){return k(a,"Function")?a:n}function r(a){return J.errorCB(Error(a)),!1}var U=w()?2:4,Y=void 0,Z=!1,D={},T={},X={},K=[[],[]],S=0,V=0,J=ia,Q=["tasks","session"];return{clear:function(){c.clear()},setUrl:aa,config:function(a){if(!a.appId)return r("appId not exist");try{V++;var c=
N.bind(null,a);!function(a,c,d){function f(b){D[a.appId]=b;b=D[a.appId].conf;var c=["singleImd","traceImd","singleDelay","traceDelay"],d=["nativesingle","nativetrace","websingle","webtrace"];b=b||{};for(var f=0;4>f;f++)if(b[c[f]])A[f]=b[c[f]];else if(a[d[f]])A[f]=a[d[f]];else{var g=W("vvc_"+d[f]);g&&(A[f]=g)}}b(P+a.appId+"_1600.json",1,{},function(a){f({event:(a=a?JSON.parse(a):{}).event||[],conf:a.conf||{}});c&&c()},function(){f({event:[],conf:{}});d&&d()})}(a,c,c)}catch(q){r(q)}},onReady:function(a){J.readyCB=
H(a)},onError:function(a){J.errorCB=H(a)},push:G,trace:G,setParams:function(a,b){return k(a,"String")?k(b,"Object")?void(X[""+a]=b):r("common set needs Object params cParams"):r("common set needs String params appId")},isInitialized:function(a){if(a)return!!D[a];a=[];for(var b in D)a.push(b);return a}}}(ja,F,H,y,function(a){if(B.connection)var b=(B.connection.type||B.connection.effectiveType).toUpperCase();else{b="4G";if(/NetType/.test(w)){var c=w.match(/NetType\/(\S*)/);c&&c[1]&&(b=c[1])}b=b.toUpperCase()}a(b)},
function(a,b,c){var d={session_id:Date.now().toString(),appId:a.appId};if(4===b)for(d=Object.assign(d,{pixel:la+"*"+ka,sdkversion:"1600",android_version:N(1)||N(0),terminal:ca()||"unknown"}),b=0;b<G.length;b++){var g=G[b],k=a[g]||W("vvc_"+g)||"";7>b&&(d[g]="id_limited"!==g&&"");k&&(d[g]=k)}c(d)},function(){return window.reportCommand&&window.reportCommand.processEvent},ma)};
"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).vTgSDK=t()
